<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlipBid Final Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #0066FF; --secondary: #0F172A; --accent: #F59E0B;
            --success: #10B981; --danger: #EF4444; --bg: #F8FAFC;
            --card-bg: #ffffff; --text: #334155;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { background-color: #1e293b; height: 100vh; display: flex; justify-content: center; align-items: center; }

        .app-container {
            width: 100%; max-width: 430px; height: 100vh; max-height: 932px;
            background: var(--bg); position: relative; display: flex; flex-direction: column;
            overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        /* --- Header --- */
        header {
            background: var(--card-bg); padding: 15px 20px; display: flex; justify-content: space-between;
            align-items: center; height: 70px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); z-index: 20;
        }
        header h1 { font-size: 1.3rem; font-weight: 700; color: var(--primary); letter-spacing: -0.5px; }

        /* --- Screens --- */
        .screen { display: none; flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; }
        .screen.active { display: flex; flex-direction: column; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- UI Elements --- */
        .btn-primary {
            background: var(--primary); color: white; border: none; padding: 16px; border-radius: 14px;
            width: 100%; font-weight: 600; font-size: 1rem; cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 102, 255, 0.25); transition: transform 0.1s;
        }
        .btn-primary:active { transform: scale(0.97); }

        .cat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .cat-card {
            background: var(--card-bg); padding: 20px; border-radius: 16px; text-align: center;
            cursor: pointer; transition: 0.2s; border: 1px solid transparent;
        }
        .cat-card:active { transform: scale(0.96); }
        .cat-card i { font-size: 1.8rem; color: var(--primary); margin-bottom: 10px; }
        .cat-card p { font-weight: 500; color: var(--text); font-size: 0.9rem; }

        /* Request & Bid Cards */
        .request-card {
            background: var(--card-bg); padding: 16px; border-radius: 16px; margin-bottom: 12px;
            border: 1px solid #e2e8f0; box-shadow: 0 2px 4px rgba(0,0,0,0.02); position: relative;
        }
        .status-badge {
            position: absolute; top: 16px; right: 16px; font-size: 0.7rem; font-weight: 700;
            padding: 4px 10px; border-radius: 20px; text-transform: uppercase;
        }
        .status-pending { background: #fff7ed; color: var(--accent); }
        .status-bids { background: #ecfdf5; color: var(--success); }

        .bid-item {
            background: white; border-radius: 16px; padding: 20px; margin-bottom: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid #f1f5f9;
        }
        .bid-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .bid-price { font-size: 1.5rem; font-weight: 700; color: var(--secondary); }
        .bid-actions { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 15px; }
        .action-btn { padding: 10px; border-radius: 10px; border: none; font-weight: 600; cursor: pointer; font-size: 0.85rem; }
        .btn-accept { background: var(--success); color: white; }
        .btn-bargain { background: var(--accent); color: white; }
        .btn-reject { background: #fee2e2; color: var(--danger); }

        /* Sidebar */
        .sidebar-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 50; display: none; backdrop-filter: blur(2px); }
        .sidebar {
            position: absolute; top: 0; left: -280px; width: 280px; height: 100%;
            background: white; z-index: 60; transition: left 0.3s; display: flex; flex-direction: column;
        }
        .sidebar.open { left: 0; }
        .sidebar-header { padding: 30px; background: var(--secondary); color: white; }
        .sidebar li { padding: 15px 30px; cursor: pointer; color: var(--text); font-weight: 500; display: flex; align-items: center; gap: 15px; }

        /* Inputs & Modals */
        .input-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.85rem; color: #64748b; margin-bottom: 8px; font-weight: 600; }
        input, select, textarea { width: 100%; padding: 14px; border: 1px solid #e2e8f0; border-radius: 12px; font-size: 1rem; outline: none; }
        .file-upload { border: 2px dashed #cbd5e1; padding: 20px; text-align: center; border-radius: 12px; cursor: pointer; }

        .modal {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 100; display: none;
            justify-content: center; align-items: flex-end;
        }
        .modal-content {
            background: white; width: 100%; border-radius: 24px 24px 0 0; padding: 30px;
            animation: slideUp 0.3s;
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body>

<div class="app-container">
    
    <div class="sidebar-overlay" id="overlay" onclick="toggleMenu()"></div>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2 id="menu-user">Guest</h2>
            <p id="menu-role" style="opacity:0.7; font-size:0.9rem;">Not Logged In</p>
        </div>
        <ul id="menu-list"></ul>
    </div>

    <header id="main-header" style="display: none;">
        <i class="fas fa-bars" style="font-size: 1.2rem; cursor: pointer;" onclick="toggleMenu()"></i>
        <h1>FlipBid</h1>
        <div onclick="navTo('profile-screen')" style="width: 35px; height: 35px; background: #f1f5f9; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer;">
            <i class="fas fa-user" style="color: #64748b;"></i>
        </div>
    </header>

    <div id="landing-screen" class="screen active" style="background: var(--secondary); color: white; text-align: center; padding-top: 150px;">
        <div style="margin-bottom: 50px;">
            <i class="fas fa-layer-group" style="font-size: 4rem; color: var(--primary); margin-bottom: 20px;"></i>
            <h1 style="font-size: 2.5rem; font-weight: 800;">FlipBid</h1>
            <p style="color: #94a3b8; font-size: 1.1rem;">Service & Material Marketplace</p>
        </div>
        <div style="padding: 20px;">
            <button class="btn-primary" onclick="login('customer')" style="margin-bottom: 15px; background: white; color: var(--secondary);">Login as Customer</button>
            <button class="btn-primary" onclick="login('vendor')" style="background: rgba(255,255,255,0.1);">Login as Vendor</button>
        </div>
    </div>

    <div id="customer-dash" class="screen">
        <div style="background: var(--secondary); border-radius: 20px; padding: 20px; color: white; margin-bottom: 25px;">
            <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                <div>
                    <p style="font-size: 0.8rem; opacity: 0.8; margin-bottom:5px;">Welcome back,</p>
                    <h2 id="dash-name">Valued Customer</h2>
                </div>
                <div style="text-align:right; background:rgba(255,255,255,0.1); padding:10px; border-radius:12px;">
                    <div style="display:flex; align-items:center; gap:8px; justify-content:flex-end; margin-bottom:5px;">
                        <img src="https://flagcdn.com/w40/bh.png" alt="Bahrain" style="width:24px; border-radius:4px;">
                        <span style="font-weight:600;">Bahrain</span>
                    </div>
                    <div style="display:flex; align-items:center; gap:5px; font-size:0.9rem;">
                        <i class="fas fa-sun" style="color:#FDB813;"></i> 26Â°C
                    </div>
                </div>
            </div>
        </div>

        <h3 style="margin-bottom: 15px; font-weight: 600;">What do you need?</h3>
        <div class="cat-grid">
            <div class="cat-card" onclick="startRequest('Cleaning')"><i class="fas fa-broom"></i><p>Cleaning</p></div>
            <div class="cat-card" onclick="startRequest('Plumbing')"><i class="fas fa-faucet"></i><p>Plumbing</p></div>
            <div class="cat-card" onclick="startRequest('Car Repair')"><i class="fas fa-car"></i><p>Car Repair</p></div>
            <div class="cat-card" onclick="startRequest('AC')"><i class="fas fa-wind"></i><p>AC Service</p></div>
            <div class="cat-card" onclick="startRequest('Construction')"><i class="fas fa-hammer"></i><p>Construction</p></div>
            <div class="cat-card" onclick="startRequest('Electrical')"><i class="fas fa-bolt"></i><p>Electrical</p></div>
        </div>

        <div style="margin-top: 30px;">
            <h3 style="margin-bottom: 15px; font-weight: 600;">Active Requests</h3>
            <div id="active-requests-list"></div>
        </div>
    </div>

    <div id="request-screen" class="screen">
        <h2 style="margin-bottom: 20px;">New Request</h2>
        <div class="input-group"><label>Service Category</label><input type="text" id="req-cat-display" disabled style="background: #f8fafc; color: #64748b;"></div>
        <div class="input-group"><label>Specific Service</label><select id="req-detail"></select></div>
        <div class="input-group"><label>Urgency</label><select id="req-urgency"><option value="Normal">Normal (Within 2 Days)</option><option value="High">High (Today)</option><option value="Emergency">Emergency (Immediate)</option></select></div>
        <div class="input-group"><label>Description</label><textarea id="req-desc" rows="3" placeholder="Describe the problem clearly..."></textarea></div>
        <div class="input-group"><label>Photos (Optional)</label><div class="file-upload" onclick="document.getElementById('file-in').click()"><i class="fas fa-camera" style="font-size: 1.5rem; color: #cbd5e1;"></i><p id="file-txt" style="font-size: 0.8rem; color: #64748b; margin-top: 5px;">Tap to upload</p><input type="file" id="file-in" hidden onchange="document.getElementById('file-txt').innerText = 'Photo Added!'"></div></div>
        <button class="btn-primary" onclick="submitRequest()">Post Request</button>
        <button style="background: transparent; border: none; width: 100%; padding: 15px; color: #64748b; margin-top: 10px;" onclick="navTo('customer-dash')">Cancel</button>
    </div>

    <div id="view-bids-screen" class="screen">
        <div style="display:flex; align-items:center; gap:15px; margin-bottom:20px;">
            <i class="fas fa-arrow-left" onclick="navTo('customer-dash')" style="cursor:pointer;"></i>
            <h2 style="font-size:1.2rem;">Compare Bids</h2>
        </div>
        <div id="bids-container"></div>
    </div>

    <div id="job-success-screen" class="screen" style="text-align:center; padding-top:50px;">
        <div style="width:80px; height:80px; background:var(--success); border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 20px;">
            <i class="fas fa-check" style="color:white; font-size:2.5rem;"></i>
        </div>
        <h1 style="color:var(--secondary); margin-bottom:10px;">Job Confirmed!</h1>
        <p style="color:#64748b; margin-bottom:30px;">Service has been booked successfully.</p>
        <button class="btn-primary" onclick="navTo('landing-screen')">Back to Home</button>
    </div>

    <div id="vendor-dash" class="screen">
        <h2>Vendor Portal</h2>
        <div style="background: var(--secondary); color: white; padding: 20px; border-radius: 16px; margin: 20px 0;">
            <div style="display:flex; justify-content:space-between;">
                <div>
                    <h3>Incoming Leads</h3>
                    <p style="font-size: 0.8rem; opacity: 0.8;">Opportunities in your area</p>
                </div>
                <h3 id="v-lead-count" style="font-size: 2rem; font-weight: 700; color: var(--accent);">0</h3>
            </div>
        </div>
        <div id="vendor-leads-list"></div>
        <button class="btn-primary" style="margin-top:20px;" onclick="navTo('supplier-screen')">Order Supplies</button>
    </div>

    <div id="vendor-bid-modal" class="modal">
        <div class="modal-content">
            <h3>Place Your Bid</h3>
            <p style="color:#64748b; font-size:0.9rem; margin-bottom:20px;">Request: <span id="modal-req-name" style="font-weight:bold;"></span></p>
            <div class="input-group">
                <label>Your Price (BHD)</label>
                <input type="number" id="vendor-bid-input" placeholder="e.g. 25">
            </div>
            <button class="btn-primary" onclick="submitVendorBid()">Send Bid</button>
            <button style="width:100%; padding:15px; border:none; background:white; color:#64748b; margin-top:10px;" onclick="document.getElementById('vendor-bid-modal').style.display='none'">Cancel</button>
        </div>
    </div>

    <div id="supplier-screen" class="screen">
        <h2>Supplier Market</h2>
        <div id="supplier-list" style="margin-top:20px;"></div>
        <button style="margin-top:20px; width:100%; padding:15px; border:none; background:#cbd5e1; border-radius:12px;" onclick="navTo('vendor-dash')">Back</button>
    </div>

    <div id="profile-screen" class="screen">
        <h2>Profile</h2>
        <div class="input-group"><label>Name</label><input type="text" id="p-name" placeholder="Enter Name"></div>
        <div class="input-group"><label>Email</label><input type="email" id="p-email" placeholder="Enter Email"></div>
        <button class="btn-primary" onclick="saveProfile()">Save Changes</button>
    </div>

    <div id="complaint-screen" class="screen">
        <h2>File Complaint</h2>
        <div class="input-group"><label>Issue</label><textarea rows="4"></textarea></div>
        <button class="btn-primary" onclick="alert('Ticket Created.'); navTo('customer-dash')">Submit</button>
    </div>

    <div id="contact-screen" class="screen">
        <h2>Contact Support</h2>
        <div class="input-group"><label>Message</label><textarea rows="4"></textarea></div>
        <button class="btn-primary" onclick="alert('Message Sent.'); navTo('customer-dash')">Send</button>
    </div>

    <div id="bargain-modal" class="modal">
        <div class="modal-content">
            <h3>Make an Offer</h3>
            <p style="color:#64748b; font-size:0.9rem; margin-bottom:20px;">Vendor's Price: <span id="modal-orig-price" style="font-weight:bold; color:var(--secondary);"></span> BHD</p>
            <div class="input-group"><label>Your Counter Offer (BHD)</label><input type="number" id="bargain-input" placeholder="e.g. 20"></div>
            <button class="btn-primary" onclick="submitCounterOffer()">Send Offer</button>
            <button style="width:100%; padding:15px; border:none; background:white; color:#64748b; margin-top:10px;" onclick="document.getElementById('bargain-modal').style.display='none'">Cancel</button>
        </div>
    </div>

</div>

<script>
    /* --- CENTRAL STATE --- */
    let requests = []; 
    let role = 'guest';

    const subtypes = {
        'Cleaning': ['Deep Clean', 'Maid Service', 'Sofa Cleaning'],
        'Plumbing': ['Leak Repair', 'Unblock Drain', 'Install Pump'],
        'Car Repair': ['Tire Change', 'Battery', 'Oil Change'],
        'AC': ['Gas Refill', 'Service', 'Compressor'],
        'Construction': ['Painting', 'Tiling', 'Gypsum'],
        'Electrical': ['Wiring', 'Socket Fix', 'Lighting']
    };

    // STRICT CATEGORY VENDOR MATCHING
    const vendorDatabase = {
        'Cleaning': [{name: 'Manama Maids', base: 20}, {name: 'Elite Cleaning', base: 25}, {name: 'Sparkle BH', base: 15}],
        'Plumbing': [{name: 'QuickFix Pipes', base: 15}, {name: 'Saar Plumbers', base: 20}, {name: 'Leak Masters', base: 18}],
        'Car Repair': [{name: 'Riffa Garage', base: 10}, {name: 'Speedy Motors', base: 35}, {name: 'AutoTech BH', base: 25}],
        'AC': [{name: 'Cool Breeze', base: 15}, {name: 'Chill Master', base: 20}, {name: 'Frosty Tech', base: 18}],
        'Construction': [{name: 'BuildRight', base: 50}, {name: 'Bahrain Reno', base: 100}, {name: 'Solid Foundation', base: 80}],
        'Electrical': [{name: 'Volt Master', base: 10}, {name: 'Bright Spark', base: 15}, {name: 'PowerFix', base: 12}]
    };

    /* --- NAVIGATION & LOGIN LOGIC --- */
    function login(r) {
        role = r;
        document.getElementById('main-header').style.display = 'flex';
        buildMenu();
        
        if(r === 'customer') {
            const savedName = document.getElementById('p-name').value;
            if(savedName) document.getElementById('dash-name').innerText = savedName;
            navTo('customer-dash');
            renderRequests();
        } else {
            // VENDOR FIX: Generate fresh leads on login
            generateSeedRequests(); 
            navTo('vendor-dash');
            renderVendorLeads();
        }
    }

    function navTo(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('overlay').style.display = 'none';
        document.getElementById('sidebar').classList.remove('open');
    }

    function toggleMenu() {
        const sb = document.getElementById('sidebar');
        const ov = document.getElementById('overlay');
        if(sb.classList.contains('open')) { sb.classList.remove('open'); ov.style.display='none'; }
        else { sb.classList.add('open'); ov.style.display='block'; }
    }

    function buildMenu() {
        const ul = document.getElementById('menu-list');
        ul.innerHTML = '';
        const savedName = document.getElementById('p-name').value;
        document.getElementById('menu-user').innerText = (role === 'customer' && savedName) ? savedName : (role === 'vendor' ? 'Vendor Inc.' : 'Guest');
        document.getElementById('menu-role').innerText = role === 'customer' ? 'Customer' : 'Service Partner';

        if(role === 'customer') {
            ul.innerHTML += `<li onclick="navTo('customer-dash')"><i class="fas fa-home"></i> Home</li>`;
            ul.innerHTML += `<li onclick="navTo('profile-screen')"><i class="fas fa-user"></i> Profile</li>`;
            ul.innerHTML += `<li onclick="navTo('complaint-screen')"><i class="fas fa-exclamation-triangle"></i> Complaints</li>`;
            ul.innerHTML += `<li onclick="navTo('contact-screen')"><i class="fas fa-envelope"></i> Support</li>`;
        } else {
            ul.innerHTML += `<li onclick="navTo('vendor-dash')"><i class="fas fa-th-large"></i> Leads</li>`;
            ul.innerHTML += `<li onclick="navTo('supplier-screen')"><i class="fas fa-boxes"></i> Suppliers</li>`;
            ul.innerHTML += `<li onclick="navTo('profile-screen')"><i class="fas fa-user"></i> Profile</li>`;
        }
        ul.innerHTML += `<li onclick="location.reload()" style="color:var(--danger);"><i class="fas fa-sign-out-alt"></i> Logout</li>`;
    }

    /* --- GENERATE SEED REQUESTS FOR VENDOR --- */
    function generateSeedRequests() {
        const cats = Object.keys(subtypes);
        const urgenices = ['Normal', 'High'];
        
        for(let i=0; i<3; i++) {
            const cat = cats[Math.floor(Math.random()*cats.length)];
            const sub = subtypes[cat][Math.floor(Math.random()*subtypes[cat].length)];
            
            const newReq = {
                id: Date.now() + i,
                cat: cat,
                detail: sub,
                urgency: urgenices[Math.floor(Math.random()*urgenices.length)],
                desc: "Auto-generated market request " + (i+1),
                status: 'Searching...',
                bids: []
            };
            requests.unshift(newReq);
        }
    }

    /* --- CUSTOMER LOGIC --- */
    let tempCat = '';

    function startRequest(cat) {
        tempCat = cat;
        document.getElementById('req-cat-display').value = cat;
        const sel = document.getElementById('req-detail');
        sel.innerHTML = '';
        subtypes[cat].forEach(s => {
            let opt = document.createElement('option');
            opt.innerText = s;
            sel.appendChild(opt);
        });
        navTo('request-screen');
    }

    function submitRequest() {
        const detail = document.getElementById('req-detail').value;
        const urgency = document.getElementById('req-urgency').value;
        const desc = document.getElementById('req-desc').value;

        if(!desc) { alert('Please describe the issue'); return; }

        const reqId = Date.now();
        const newReq = {
            id: reqId, cat: tempCat, detail: detail, urgency: urgency, desc: desc, status: 'Searching...', bids: []
        };

        requests.unshift(newReq);
        navTo('customer-dash');
        renderRequests();
        
        setTimeout(() => {
            if(newReq.bids.length === 0) simulateBotBids(reqId);
        }, 5000);
    }

    function renderRequests() {
        const list = document.getElementById('active-requests-list');
        list.innerHTML = '';
        if(requests.length === 0) { list.innerHTML = '<p style="text-align:center; color:#94a3b8;">No active requests.</p>'; return; }

        requests.forEach(r => {
            let statusClass = r.bids.length > 0 ? 'status-bids' : 'status-pending';
            let actionButton = r.bids.length > 0 ? `<button class="btn-primary" style="padding:10px; margin-top:10px; font-size:0.9rem;" onclick="viewBids(${r.id})">View ${r.bids.length} Bids</button>` : '';

            list.innerHTML += `
                <div class="request-card">
                    <span class="status-badge ${statusClass}">${r.bids.length > 0 ? r.bids.length + ' Bids Ready' : r.status}</span>
                    <h4 style="font-weight:600; margin-bottom:4px;">${r.cat} - ${r.detail}</h4>
                    <p style="font-size:0.85rem; color:#64748b;">${r.desc}</p>
                    ${actionButton}
                </div>
            `;
        });
    }

    function simulateBotBids(reqId) {
        const req = requests.find(r => r.id === reqId);
        if(!req) return;
        if(req.bids.length > 0) return; 

        // FIXED: STRICT CATEGORY MATCHING
        const bots = vendorDatabase[req.cat] || vendorDatabase['Cleaning'];
        
        const mockBids = bots.map(v => ({
            name: v.name,
            price: v.base + Math.floor(Math.random() * 10),
            rating: (4 + Math.random()).toFixed(1)
        }));

        req.bids.push(...mockBids);
        req.status = 'Bids Received';
        renderRequests();
        if(role === 'customer') alert("New Bids Received!");
    }

    /* --- VENDOR LOGIC --- */
    let selectedLeadId = null;

    function renderVendorLeads() {
        const container = document.getElementById('vendor-leads-list');
        container.innerHTML = ''; 
        const leads = requests.filter(r => !r.status.includes('Booked'));
        document.getElementById('v-lead-count').innerText = leads.length;

        if(leads.length === 0) {
            container.innerHTML = '<p style="text-align:center; color:#999; margin-top:20px;">No new leads.</p>';
        }

        leads.forEach(r => {
            container.innerHTML += `
                <div class="request-card" style="border-left:4px solid var(--primary);">
                    <div style="display:flex; justify-content:space-between;">
                         <h4 style="margin:8px 0;">${r.detail}</h4>
                         <span style="font-size:0.7rem; background:#eee; padding:2px 8px; height:20px; border-radius:10px;">${r.urgency}</span>
                    </div>
                    <p style="font-size:0.9rem; color:#64748b;">"${r.desc}"</p>
                    <button class="btn-primary" style="padding:10px; margin-top:10px;" onclick="openBidModal(${r.id}, '${r.detail}')">Bid Now</button>
                </div>
            `;
        });
    }

    function openBidModal(id, title) {
        selectedLeadId = id;
        document.getElementById('modal-req-name').innerText = title;
        document.getElementById('vendor-bid-input').value = '';
        document.getElementById('vendor-bid-modal').style.display = 'flex';
    }

    function submitVendorBid() {
        const price = document.getElementById('vendor-bid-input').value;
        if(!price) return;
        
        const req = requests.find(r => r.id === selectedLeadId);
        req.bids.push({
            name: 'Vendor Inc. (You)',
            price: price,
            rating: '5.0'
        });
        req.status = 'Bids Received';
        
        document.getElementById('vendor-bid-modal').style.display = 'none';
        alert('Bid Sent! Customer will see it.');
        renderVendorLeads();
    }

    /* --- BIDDING & BARGAINING --- */
    let currentReqId = null;
    let currentBidIdx = null;

    function viewBids(reqId) {
        currentReqId = reqId;
        const req = requests.find(r => r.id === reqId);
        const container = document.getElementById('bids-container');
        container.innerHTML = '';

        req.bids.forEach((bid, index) => {
            container.innerHTML += `
                <div class="bid-item">
                    <div class="bid-header">
                        <div>
                            <div style="font-weight:600;">${bid.name}</div>
                            <div style="font-size:0.8rem; color:#f59e0b;"><i class="fas fa-star"></i> ${bid.rating}</div>
                        </div>
                        <div class="bid-price">${bid.price} BHD</div>
                    </div>
                    <div class="bid-actions">
                        <button class="action-btn btn-accept" onclick="acceptBid(${reqId}, ${index})">Accept</button>
                        <button class="action-btn btn-bargain" onclick="openBargain(${reqId}, ${index}, ${bid.price})">Bargain</button>
                        <button class="action-btn btn-reject" onclick="rejectBid(${reqId}, ${index})">Reject</button>
                    </div>
                </div>
            `;
        });
        navTo('view-bids-screen');
    }

    function acceptBid(reqId, idx) {
        const req = requests.find(r => r.id === reqId);
        req.status = `Booked: ${req.bids[idx].name}`;
        alert('Job Confirmed!');
        navTo('job-success-screen');
    }

    function rejectBid(reqId, idx) {
        const req = requests.find(r => r.id === reqId);
        req.bids.splice(idx, 1);
        viewBids(reqId); 
    }

    function openBargain(reqId, idx, price) {
        currentReqId = reqId;
        currentBidIdx = idx;
        document.getElementById('modal-orig-price').innerText = price;
        document.getElementById('bargain-input').value = '';
        document.getElementById('bargain-modal').style.display = 'flex';
    }

    function submitCounterOffer() {
        const offer = parseInt(document.getElementById('bargain-input').value);
        const req = requests.find(r => r.id === currentReqId);
        const bid = req.bids[currentBidIdx];
        
        document.getElementById('bargain-modal').style.display = 'none';
        
        if(offer >= bid.price * 0.8) {
            if(confirm(`${bid.name} ACCEPTED your offer of ${offer} BHD!`)) {
                bid.price = offer;
                acceptBid(currentReqId, currentBidIdx);
            }
        } else {
            alert(`${bid.name} REJECTED your offer.`);
        }
    }

    /* --- UTILS --- */
    function saveProfile() { 
        const name = document.getElementById('p-name').value;
        if(name) document.getElementById('dash-name').innerText = name;
        alert('Profile Saved'); 
        if(role === 'customer') navTo('customer-dash'); else navTo('vendor-dash');
    }
    
    const suppliers = [{item: 'Cement (50kg)', price: '2.5 BHD'}, {item: 'Paint (18L)', price: '12.0 BHD'}, {item: 'PVC Pipe (3m)', price: '4.0 BHD'}];
    const supList = document.getElementById('supplier-list');
    suppliers.forEach(s => {
        supList.innerHTML += `<div style="background:white; padding:15px; border-radius:10px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;"><div><strong>${s.item}</strong><br><span style="color:var(--primary);">${s.price}</span></div><button style="padding:5px 15px; border-radius:20px; border:none; background:#e2e8f0;">Order</button></div>`;
    });
</script>

</body>
</html>